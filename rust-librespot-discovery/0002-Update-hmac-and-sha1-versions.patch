From 32337035308870db60ec5e0944ee7a7dec3d3694 Mon Sep 17 00:00:00 2001
From: Mat Booth <mat.booth@gmail.com>
Date: Mon, 2 Dec 2024 14:57:21 +0000
Subject: [PATCH 2/3] Update hmac and sha1 versions

---
 Cargo.toml    | 4 ++--
 src/server.rs | 4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/Cargo.toml b/Cargo.toml
index ffac104..5cba65e 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -36,7 +36,7 @@ version = "1.0"
 version = "0.3"
 
 [dependencies.hmac]
-version = "0.11"
+version = "0.12"
 
 [dependencies.hyper]
 version = "0.14"
@@ -63,7 +63,7 @@ version = "0.8"
 version = "1.0.25"
 
 [dependencies.sha-1]
-version = "0.9"
+version = "0.10"
 
 [dependencies.thiserror]
 version = "1.0"
diff --git a/src/server.rs b/src/server.rs
index 1294b40..1051fef 100644
--- a/src/server.rs
+++ b/src/server.rs
@@ -10,7 +10,7 @@ use aes::cipher::generic_array::GenericArray;
 use aes::cipher::{NewCipher, StreamCipher};
 use aes::Aes128Ctr;
 use futures_core::Stream;
-use hmac::{Hmac, Mac, NewMac};
+use hmac::{Hmac, Mac};
 use hyper::service::{make_service_fn, service_fn};
 use hyper::{Body, Method, Request, Response, StatusCode};
 use log::{debug, warn};
@@ -110,7 +110,7 @@ impl RequestHandler {
         let mut h =
             Hmac::<Sha1>::new_from_slice(&checksum_key).expect("HMAC can take key of any size");
         h.update(encrypted);
-        if h.verify(cksum).is_err() {
+        if h.verify_slice(cksum).is_err() {
             warn!("Login error for user {:?}: MAC mismatch", username);
             let result = json!({
                 "status": 102,
-- 
2.47.0

