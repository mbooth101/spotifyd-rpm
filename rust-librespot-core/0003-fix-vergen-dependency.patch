From f3a32330e6ce5ff5c1acc7b0174b95091c3a9dd2 Mon Sep 17 00:00:00 2001
From: Mat Booth <mat.booth@gmail.com>
Date: Sat, 18 Oct 2025 11:48:10 +0100
Subject: [PATCH 3/3] fix vergen dependency

---
 Cargo.toml |  6 +++---
 build.rs   | 21 ++++++---------------
 2 files changed, 9 insertions(+), 18 deletions(-)

diff --git a/Cargo.toml b/Cargo.toml
index 742b2a1..546f28e 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -233,7 +233,7 @@ features = [
 [build-dependencies.rand]
 version = "0.8"
 
-[build-dependencies.vergen-gitcl]
-version = "1.0.0"
-features = ["build"]
+[build-dependencies.vergen]
+version = "8"
+features = ["build", "git", "gitcl"]
 default-features = false
diff --git a/build.rs b/build.rs
index 008ec1d..920455d 100644
--- a/build.rs
+++ b/build.rs
@@ -1,19 +1,11 @@
 use rand::{distributions::Alphanumeric, Rng};
-use vergen_gitcl::{BuildBuilder, Emitter, GitclBuilder};
+use vergen::EmitBuilder;
 
-fn main() -> Result<(), Box<dyn std::error::Error>> {
-    let gitcl = GitclBuilder::default()
-        .sha(true) // outputs 'VERGEN_GIT_SHA', and sets the 'short' flag true
-        .commit_date(true) // outputs 'VERGEN_GIT_COMMIT_DATE'
-        .build()?;
-
-    let build = BuildBuilder::default()
-        .build_date(true) // outputs 'VERGEN_BUILD_DATE'
-        .build()?;
-
-    Emitter::default()
-        .add_instructions(&build)?
-        .add_instructions(&gitcl)?
+fn main() {
+    EmitBuilder::builder()
+        .build_date() // outputs 'VERGEN_BUILD_DATE'
+        .git_sha(true) // outputs 'VERGEN_GIT_SHA', and sets the 'short' flag true
+        .git_commit_date() // outputs 'VERGEN_GIT_COMMIT_DATE'
         .emit()
         .expect("Unable to generate the cargo keys!");
     let build_id = match std::env::var("SOURCE_DATE_EPOCH") {
@@ -26,5 +18,4 @@ fn main() -> Result<(), Box<dyn std::error::Error>> {
     };
 
     println!("cargo:rustc-env=LIBRESPOT_BUILD_ID={build_id}");
-    Ok(())
 }
-- 
2.51.0

